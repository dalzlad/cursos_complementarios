<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üìä M√ìDULO 4 ‚Äî Consultas avanzadas y operadores en MongoDB</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --brand-1: #0ea5a4; 
      --brand-2: #0369a1; 
      --muted: #374151;
      --bg-warm: #f5f9fb;
      --code-bg: #0b1220;
    }
    html { font-size: 18px; }
    body{
      background: linear-gradient(135deg, #f0f6fb 0%, #eef7ff 100%);
      color: #0f172a;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.6;
    }
    .card { background: white; border-radius:14px; box-shadow: 0 10px 30px rgba(2,6,23,0.06); }
    pre.code {
      background: var(--code-bg);
      color: #e6f3f1;
      padding: 1rem;
      border-radius: 10px;
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
      font-size: 1rem;
      line-height:1.6;
    }
    code.inline { background: rgba(3,105,161,0.06); padding: 0.12rem 0.45rem; border-radius:6px; font-family: ui-monospace, monospace; }
    .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .9rem; border-radius:10px; font-weight:600; cursor:pointer; transition:transform .12s ease, box-shadow .12s ease; }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{ background: linear-gradient(90deg,var(--brand-1),var(--brand-2)); color:white; box-shadow:0 8px 20px rgba(3,105,161,0.12); }
    .btn-ghost{ background:white; border:1px solid rgba(3,105,161,0.08); color:var(--brand-2); }

    details summary { list-style: none; cursor: pointer; padding: .75rem 1rem; border-radius: 10px; background: linear-gradient(180deg, rgba(6,95,70,0.04), transparent); font-weight:600; }
    details[open] summary{ background: linear-gradient(180deg, rgba(3,105,161,0.06), transparent); }
    details > .content { padding: 0.75rem 1rem 1rem 1rem; }

    .small { font-size: .95rem; color:var(--muted); }
    .kbd { background:#111827;color:white;padding:2px 8px;border-radius:6px;font-family:ui-monospace,monospace;font-size:.9rem }

    @media (max-width:768px){
      html { font-size:17px; }
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <header class="sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-gray-100">
    <nav class="max-w-6xl mx-auto px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="../index.html" class="flex items-center gap-2">
          <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background:linear-gradient(180deg,var(--brand-1),var(--brand-2));">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 2C12 2 7 6 7 11C7 15 11 20 12 22C13 20 17 15 17 11C17 6 12 2 12 2Z" fill="white"/></svg>
          </div>
          <span class="font-semibold text-lg text-slate-800">Curso MongoDB</span>
        </a>
      </div>

      <div class="flex items-center gap-3 text-sm font-medium">
        <a href="../modulos/modulo1.html" class="px-3 py-2 rounded hover:bg-slate-50">M√≥dulo 1</a>
        <a href="../modulos/modulo2.html" class="px-3 py-2 rounded hover:bg-slate-50">M√≥dulo 2</a>
        <a href="../modulos/modulo3.html" class="px-3 py-2 rounded hover:bg-slate-50">M√≥dulo 3</a>
        <a href="../modulos/modulo4.html" class="px-3 py-2 rounded hover:bg-slate-50">M√≥dulo 4</a>
        <a href="#" class="px-3 py-2 rounded bg-slate-100 text-slate-900 font-semibold">M√≥dulo 5</a>
        <a href="../modulos/modulo6.html" class="px-3 py-2 rounded hover:bg-slate-50">M√≥dulo 6</a>
        <a href="../modulos/modulo7.html" class="px-3 py-2 rounded hover:bg-slate-50">M√≥dulo 7</a>
      </div>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-10">

    <!-- Header / Hero -->
    <section class="mb-8 text-center">
      <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900">üìä M√ìDULO 5 ‚Äî Consultas avanzadas y operadores en MongoDB</h1>
      <p class="text-lg text-gray-600 mt-2">Duraci√≥n: <strong>3 horas</strong> ‚Ä¢ Nivel: <strong>B√°sico</strong></p>

      <div class="mt-4 flex items-center justify-center gap-3">
        <button id="openIndex" class="btn btn-ghost" onclick="location.href='../index.html'">Volver al √≠ndice</button>
      </div>
    </section>

    <!-- Summary -->
    <section class="card p-6 mb-6 flex items-center justify-between gap-6">
      <div>
        <div class="text-sm text-gray-500">Objetivos</div>
        <h2 class="text-xl font-semibold text-slate-900">Aprender operadores avanzados y consultas complejas en MongoDB</h2>
      </div>
      <div class="flex items-center gap-4">
        <div class="text-sm text-gray-500">Progreso m√≥dulo</div>
        <div id="progressLabel" class="text-teal-700 font-semibold">0% completado</div>
      </div>
    </section>

    <!-- Objectives -->
    <section class="card p-6 mb-6">
      <h3 class="text-2xl font-semibold text-slate-900 mb-3">üéØ Objetivos del m√≥dulo</h3>
      <ul class="list-disc pl-6 space-y-2 text-lg text-gray-700">
        <li>Dominar operadores de comparaci√≥n, l√≥gicos y de array.</li>
        <li>Usar operadores de proyecci√≥n avanzada.</li>
        <li>Construir consultas con <code class="inline">$elemMatch</code>, <code class="inline">$in</code>, <code class="inline">$regex</code>.</li>
        <li>Combinar filtros complejos y paginaci√≥n eficiente.</li>
        <li>Aplicar buenas pr√°cticas en consultas avanzadas para producci√≥n.</li>
      </ul>
    </section>

    <!-- 1. Operadores de comparaci√≥n -->
    <section class="card p-6 mb-6">
      <h4 class="text-xl font-semibold mb-3">1. Operadores de comparaci√≥n</h4>

      <details class="mb-4" open>
        <summary>Concepto y ejemplos</summary>
        <div class="content">
          <p class="small mb-2">Se usan para filtrar documentos seg√∫n valores num√©ricos, cadenas o fechas.</p>

          <div class="space-y-4">
            <div>
              <strong>$eq / $ne ‚Äî Igual / Distinto</strong>
              <pre class="code">db.productos.find({ precio: { $eq: 35000 } })
db.productos.find({ precio: { $ne: 35000 } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ precio: { $eq: 35000 } }); db.productos.find({ precio: { $ne: 35000 } });'>Copiar</button>
            </div>

            <div>
              <strong>$gt / $gte ‚Äî Mayor que / Mayor o igual</strong>
              <pre class="code">db.productos.find({ precio: { $gt: 20000 } })
db.productos.find({ precio: { $gte: 35000 } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ precio: { $gt: 20000 } }); db.productos.find({ precio: { $gte: 35000 } });'>Copiar</button>
            </div>

            <div>
              <strong>$lt / $lte ‚Äî Menor que / Menor o igual</strong>
              <pre class="code">db.productos.find({ stock: { $lt: 10 } })
db.productos.find({ stock: { $lte: 12 } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ stock: { $lt: 10 } }); db.productos.find({ stock: { $lte: 12 } });'>Copiar</button>
            </div>

            <div>
              <strong>$in / $nin ‚Äî Contiene / No contiene</strong>
              <pre class="code">db.productos.find({ categorias: { $in: ["oferta", "nuevo"] } })
db.productos.find({ categorias: { $nin: ["oferta"] } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ categorias: { $in: ["oferta", "nuevo"] } }); db.productos.find({ categorias: { $nin: ["oferta"] } });'>Copiar</button>
            </div>
          </div>
        </div>
      </details>
    </section>

    <!-- 2. Operadores l√≥gicos -->
    <section class="card p-6 mb-6">
      <h4 class="text-xl font-semibold mb-3">2. Operadores l√≥gicos</h4>

      <details class="mb-4" open>
        <summary>Combinar condiciones</summary>
        <div class="content">
          <div class="space-y-4">
            <div>
              <strong>$and ‚Äî Todas las condiciones</strong>
              <pre class="code">db.productos.find({ $and: [ { precio: { $gt: 20000 } }, { stock: { $gte: 5 } } ] })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ $and: [ { precio: { $gt: 20000 } }, { stock: { $gte: 5 } } ] })'>Copiar</button>
            </div>

            <div>
              <strong>$or ‚Äî Alguna condici√≥n</strong>
              <pre class="code">db.productos.find({ $or: [ { stock: { $lt: 5 } }, { precio: { $gt: 50000 } } ] })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ $or: [ { stock: { $lt: 5 } }, { precio: { $gt: 50000 } } ] })'>Copiar</button>
            </div>

            <div>
              <strong>$not ‚Äî Negaci√≥n</strong>
              <pre class="code">db.productos.find({ precio: { $not: { $gt: 50000 } } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ precio: { $not: { $gt: 50000 } } })'>Copiar</button>
            </div>

            <div>
              <strong>$nor ‚Äî Ninguna condici√≥n</strong>
              <pre class="code">db.productos.find({ $nor: [ { stock: { $lt: 5 } }, { precio: { $gt: 50000 } } ] })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ $nor: [ { stock: { $lt: 5 } }, { precio: { $gt: 50000 } } ] })'>Copiar</button>
            </div>
          </div>
        </div>
      </details>
    </section>

    <!-- 3. Consultas sobre arrays -->
    <section class="card p-6 mb-6">
      <h4 class="text-xl font-semibold mb-3">3. Consultas sobre arrays</h4>

      <details class="mb-4" open>
        <summary>$elemMatch y operadores de array</summary>
        <div class="content">
          <div class="space-y-4">
            <div>
              <strong>$elemMatch ‚Äî Coincidencia espec√≠fica</strong>
              <pre class="code">db.productos.find({ categorias: { $elemMatch: { $eq: "oferta" } } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ categorias: { $elemMatch: { $eq: "oferta" } } })'>Copiar</button>
            </div>

            <div>
              <strong>$size ‚Äî Tama√±o del array</strong>
              <pre class="code">db.productos.find({ categorias: { $size: 2 } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ categorias: { $size: 2 } })'>Copiar</button>
            </div>

            <div>
              <strong>$all ‚Äî Todos los elementos</strong>
              <pre class="code">db.productos.find({ categorias: { $all: ["ropa","nuevo"] } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ categorias: { $all: ["ropa","nuevo"] } })'>Copiar</button>
            </div>
          </div>
        </div>
      </details>
    </section>

    <!-- 4. Regex y proyecciones -->
    <section class="card p-6 mb-6">
      <h4 class="text-xl font-semibold mb-3">4. B√∫squedas por patrones y proyecciones avanzadas</h4>

      <details class="mb-4" open>
        <summary>$regex y proyecci√≥n condicional</summary>
        <div class="content">
          <div class="space-y-4">
            <div>
              <strong>B√∫squeda por patr√≥n</strong>
              <pre class="code">db.productos.find({ nombre: { $regex: "^Cami", $options: "i" } })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({ nombre: { $regex: "^Cami", $options: "i" } })'>Copiar</button>
            </div>

            <div>
              <strong>Proyecci√≥n condicional</strong>
              <pre class="code">db.productos.find({}, { nombre: 1, categorias: 1, _id: 0 })</pre>
              <button class="btn btn-ghost" data-copy='db.productos.find({}, { nombre: 1, categorias: 1, _id: 0 })'>Copiar</button>
            </div>
          </div>
        </div>
      </details>
    </section>

    <!-- 5. Ejercicios guiados -->
    <section class="card p-6 mb-6">
      <h4 class="text-xl font-semibold mb-3">5. Ejercicios guiados</h4>

      <details class="mb-3">
        <summary>Ejercicio 1 ‚Äî Filtrar productos caros y en oferta</summary>
        <div class="content">
          <p class="small">Encuentra productos con precio &gt; 30000 y que tengan "oferta" en categor√≠as.</p>
          <pre class="code">db.productos.find({ $and: [ { precio: { $gt: 30000 } }, { categorias: { $in: ["oferta"] } } ] })</pre>
          <button class="btn btn-ghost" data-copy='db.productos.find({ $and: [ { precio: { $gt: 30000 } }, { categorias: { $in: ["oferta"] } } ] })'>Copiar</button>
        </div>
      </details>

      <details class="mb-3">
        <summary>Ejercicio 2 ‚Äî Productos sin stock o muy caros</summary>
        <div class="content">
          <p class="small">Usa $or para filtrar stock ‚â§ 0 o precio ‚â• 80000.</p>
          <pre class="code">db.productos.find({ $or: [ { stock: { $lte: 0 } }, { precio: { $gte: 80000 } } ] })</pre>
          <button class="btn btn-ghost" data-copy='db.productos.find({ $or: [ { stock: { $lte: 0 } }, { precio: { $gte: 80000 } } ] })'>Copiar</button>
        </div>
      </details>

      <details class="mb-3">
        <summary>Ejercicio 3 ‚Äî Buscar por nombre con regex</summary>
        <div class="content">
          <p class="small">Encuentra productos cuyo nombre comience con "Z" (may√∫scula o min√∫scula).</p>
          <pre class="code">db.productos.find({ nombre: { $regex: "^Z", $options: "i" } })</pre>
          <button class="btn btn-ghost" data-copy='db.productos.find({ nombre: { $regex: "^Z", $options: "i" } })'>Copiar</button>
        </div>
      </details>
    </section>

    <!-- Secci√≥n de preguntas de repaso y quizz -->
  <section class="card p-6 mb-6">
    <h4 class="text-xl font-semibold mb-3">üìù Preguntas de repaso</h4>
    <ul class="list-disc pl-6 space-y-2 text-lg text-gray-700">
      <li>¬øQu√© operador usar√≠as para filtrar productos con precio mayor a 50000?</li>
      <li>¬øC√≥mo combinar√≠as condiciones que deben cumplirse todas a la vez?</li>
      <li>¬øCu√°l es la diferencia entre <code class="inline">$in</code> y <code class="inline">$all</code>?</li>
      <li>¬øQu√© operador permite buscar documentos donde un array tenga un elemento espec√≠fico?</li>
      <li>¬øC√≥mo proyectar solo algunos campos de un documento sin incluir el <code class="inline">_id</code>?</li>
    </ul>
  </section>

  <!-- Secci√≥n de mini-quizz interactivo -->
  <section class="card p-6 mb-6">
    <h4 class="text-xl font-semibold mb-3">üéØ Mini-Quizz interactivo</h4>
    <div class="space-y-4">
      <div>
        <p class="small mb-2">1Ô∏è‚É£ ¬øCu√°l operador devuelve documentos donde el precio no es igual a 35000?</p>
        <button class="btn btn-ghost" onclick="checkAnswer(this,true)">$ne</button>
        <button class="btn btn-ghost" onclick="checkAnswer(this,false)">$eq</button>
        <button class="btn btn-ghost" onclick="checkAnswer(this,false)">$gt</button>
      </div>

      <div>
        <p class="small mb-2">2Ô∏è‚É£ Quieres todos los documentos cuyo stock sea menor a 5 o precio mayor a 50000. ¬øQu√© operador l√≥gico usar√≠as?</p>
        <button class="btn btn-ghost" onclick="checkAnswer(this,true)">$or</button>
        <button class="btn btn-ghost" onclick="checkAnswer(this,false)">$and</button>
        <button class="btn btn-ghost" onclick="checkAnswer(this,false)">$not</button>
      </div>

      <div>
        <p class="small mb-2">3Ô∏è‚É£ Necesitas filtrar productos con categor√≠as "ropa" y "nuevo" al mismo tiempo. ¬øQu√© operador usar√≠as?</p>
        <button class="btn btn-ghost" onclick="checkAnswer(this,true)">$all</button>
        <button class="btn btn-ghost" onclick="checkAnswer(this,false)">$in</button>
        <button class="btn btn-ghost" onclick="checkAnswer(this,false)">$elemMatch</button>
      </div>
    </div>
    <div id="quizzResult" class="mt-4 font-semibold text-lg"></div>
  </section>

  <!-- Cheatsheet / Resumen visual -->
  <section class="card p-6 mb-6">
    <h4 class="text-xl font-semibold mb-3">üìå Cheatsheet: operadores MongoDB</h4>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
      <div>
        <strong>Comparaci√≥n:</strong>
        <ul class="list-disc pl-6">
          <li><code class="inline">$eq</code> = igual</li>
          <li><code class="inline">$ne</code> ‚â† distinto</li>
          <li><code class="inline">$gt</code> > mayor que</li>
          <li><code class="inline">$gte</code> ‚â• mayor o igual</li>
          <li><code class="inline">$lt</code> < menor que</li>
          <li><code class="inline">$lte</code> ‚â§ menor o igual</li>
          <li><code class="inline">$in</code> contiene</li>
          <li><code class="inline">$nin</code> no contiene</li>
        </ul>
      </div>
      <div>
        <strong>L√≥gicos y arrays:</strong>
        <ul class="list-disc pl-6">
          <li><code class="inline">$and</code> todas las condiciones</li>
          <li><code class="inline">$or</code> alguna condici√≥n</li>
          <li><code class="inline">$not</code> negaci√≥n</li>
          <li><code class="inline">$nor</code> ninguna condici√≥n</li>
          <li><code class="inline">$elemMatch</code> coincidencia en array</li>
          <li><code class="inline">$size</code> tama√±o de array</li>
          <li><code class="inline">$all</code> todos los elementos</li>
          <li><code class="inline">$regex</code> b√∫squeda por patr√≥n</li>
        </ul>
      </div>
    </div>
  </section>

  <script>
  function checkAnswer(button, isCorrect){
    const result = document.getElementById('quizzResult');
    if(isCorrect){
      result.innerHTML = '‚úÖ Correcto!';
      button.classList.add('bg-green-500','text-white');
    } else {
      result.innerHTML = '‚ùå Intenta de nuevo';
      button.classList.add('bg-red-500','text-white');
    }
    setTimeout(()=>result.innerHTML='',1500);
  }
  </script>


    <!-- Reflexi√≥n -->
    <section class="card p-6 mb-6">
      <h4 class="text-xl font-semibold mb-3">üß† Reflexi√≥n final</h4>
      <ul class="list-disc pl-6 text-lg text-gray-700 space-y-2">
        <li>Los operadores avanzados permiten filtrar con precisi√≥n grandes colecciones.</li>
        <li>Combina operadores l√≥gicos y de array para consultas complejas.</li>
        <li>Regex y proyecciones ayudan a optimizar la cantidad de datos transferidos.</li>
      </ul>

      <div class="mt-4 p-4 bg-teal-50 rounded-lg border-l-4 border-teal-400">
        <strong>‚úÖ Resultado esperado:</strong>
        <ul class="list-disc pl-6 mt-2 text-gray-700">
          <li>Saber usar operadores de comparaci√≥n, l√≥gicos y de array.</li>
          <li>Construir consultas avanzadas eficientes y seguras.</li>
          <li>Haber completado los ejercicios guiados en tu cluster/Compass.</li>
        </ul>
      </div>
    </section>

    <!-- bottom actions -->
<!-- Footer / Navegaci√≥n -->
<div class="flex flex-col md:flex-row items-center justify-between gap-4 mt-6">
  <div class="flex gap-3">
    <a href="../index.html" class="btn btn-ghost">Volver al √≠ndice</a>
  </div>
</div>

<footer class="mt-10 text-center text-sm text-gray-500">üå± Curso Sincr√≥nico ‚Äî Introducci√≥n a MongoDB Atlas</footer>

   
  </main>

  <!-- SCRIPTS -->
  <script>
    function showToast(msg){
      const b = document.createElement('div');
      b.innerText = msg;
      Object.assign(b.style,{position:'fixed',right:'18px',bottom:'18px',background:'linear-gradient(90deg,#0ea5a4,#0369a1)',color:'white',padding:'10px 14px',borderRadius:'10px',boxShadow:'0 10px 30px rgba(0,0,0,0.18)',zIndex:9999});
      document.body.appendChild(b);
      setTimeout(()=>b.remove(),1400);
    }

    document.addEventListener('click', function(e){
      const btn = e.target.closest('button[data-copy]');
      if(!btn) return;
      const text = btn.getAttribute('data-copy');
      if(!text) return;
      navigator.clipboard?.writeText(text).then(()=> showToast('Copiado al portapapeles ‚úì')).catch(()=> {
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select();
        try { document.execCommand('copy'); showToast('Copiado al portapapeles ‚úì'); } catch(e){ alert('No se pudo copiar'); }
        ta.remove();
      });
    });

    document.querySelectorAll('details').forEach(d=>{
      const s = d.querySelector('summary');
      s.addEventListener('keydown', (ev)=> { if(ev.key==='Enter'||ev.key===' '){ ev.preventDefault(); d.open=!d.open; } });
    });

    function setCompleted(val){
      try {
        localStorage.setItem('mod4_completed', val ? '1' : '0');
        updateProgress();
        showToast(val ? 'M√≥dulo 4 marcado como completado ‚úÖ' : 'M√≥dulo 4 marcado como no completado');
      } catch(e){ console.error(e); }
    }
    document.getElementById('markDoneTop').addEventListener('click', ()=> setCompleted(true));
    document.getElementById('markDoneBottom').addEventListener('click', ()=> setCompleted(true));

    function updateProgress(){
      const done = localStorage.getItem('mod4_completed') === '1';
      document.getElementById('progressLabel').innerText = done ? '100% completado' : '0% completado';
      document.querySelectorAll('#markDoneTop, #markDoneBottom').forEach(b => b.setAttribute('aria-pressed', done ? 'true' : 'false'));
    }
    updateProgress();

    window.addEventListener('keydown', (e)=> { if(e.key.toLowerCase()==='m') setCompleted(true); });
    document.querySelectorAll('pre.code').forEach(p=>p.setAttribute('tabindex','0'));
  </script>

  <script>
    localStorage.setItem("modulo4_estado", "completed");
  </script>
</body>
</html>
